@using Newtonsoft.Json
@model PostJobViewModel
@{
    ViewBag.Title = "Post Job";
}
<style>
    #skillRecommendations {
        max-height: 150px;
        overflow-y: auto;
        width: 100%;
    }

    .badge {
        display: inline-block;
        padding: 0.5em 0.75em;
        font-size: 0.875rem;
        border-radius: 0.25rem;
    }
</style>
 <!-- content area -->
<div class="dashboard__content d-flex template-dashboard ">
    <partial name="_LeftMenu" />
    <div class="dashboard__right">
        <div class="dash__content" id="content-area">
            <!-- sidebar menu -->
            <div class="sidebar__menu d-md-block d-lg-none">
                <div class="sidebar__action"><i class="fa-sharp fa-regular fa-bars"></i>Sidebar</div>
            </div>
            <!-- sidebar menu end -->
            <!-- submit form -->
            <form asp-controller="employer" asp-action="postjob" id="postjobform">
                <div class="my__profile__tab radius-16 bg-white">
                    <nav>
                        <div class="nav nav-tabs">
                            <a class="nav-link active" href="#info">Company Details</a>
                            <a class="nav-link" href="#jobdetail">Job Detail</a>
                        </div>
                    </nav>
                    <div class="my__details" id="info">
                        <div class="info__field pt-3">
                            <div class="row row-cols-1 g-3">
                                <div class="rt-input-group">
                                    <label asp-for="Title">Job Title</label>
                                    <input asp-for="Title" placeholder="Enter title" data-val-required="Post title is required">
                                </div>
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>
                            <div class="row row-cols-1">
                                <div class="rt-input-group">
                                    <label asp-for="Description">Job Description</label>
                                    <textarea asp-for="Description" placeholder="Enter description"></textarea>
                                </div>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                            <div class="row row-cols-1">
                                <div class="rt-input-group">
                                    <label asp-for="Responsibilities">Responsibilities</label>
                                    <textarea asp-for="Responsibilities" placeholder="Enter responsibilities"></textarea>
                                </div>
                                <span asp-validation-for="Responsibilities" class="text-danger"></span>
                            </div>
                            <div class="row row-cols-1">
                                <div class="rt-input-group">
                                    <label asp-for="Requirements">Requirements</label>
                                    <textarea asp-for="Requirements" placeholder="Enter requirements"></textarea>
                                </div>
                                <span asp-validation-for="Requirements" class="text-danger"></span>
                            </div>
                            <div class="rt-input-group">
                                <label for="skills">Skills</label>
                                <input type="text" id="skillInput" class="form-control" placeholder="Type a skill" autocomplete="off" />
                                <ul id="skillRecommendations" class="list-group" style="display: none; position: absolute; z-index: 1000; width: auto;"></ul>
                                @Html.HiddenFor(j => j.SelectedSkill)
                            </div>
                            <div id="skillTags">
                                <!-- Tags will appear here -->
                            </div>
                            <span asp-validation-for="SelectedSkill" class="text-danger"></span>
                        </div>
                    </div>
                </div>
                <!-- address area -->
                <h6 class="fw-medium mt-30 mb-20" id="jobdetail">Job Detail</h6>
                <div class="social__links radius-16 p-30 bg-white">
                    <div class="info__field">
                        <div class="row row-cols-sm-1 row-cols-1 g-3">
                            <div class="info__field">
                                <div class="row row-cols-sm-2 row-cols-1 g-3">
                                    <div class="position-relative">
                                        <div class="rt-input-group">
                                            <label asp-for="Location">Location</label>
                                            <select asp-for="Location" class="form-select" onchange="toggleCustomField(this, '#customLocationInput')">
                                                <option value="Ha Noi">Ha Noi</option>
                                                <option value="Da Nang">Da Nang</option>
                                                <option value="Ho Chi Minh City">Ho Chi Minh City</option>
                                                <option value="Remote">Remote</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div id="customLocationInput" class="rt-input-group" style="display: none; margin-top: 1rem;">
                                            <label asp-for="CustomLocation">Custom Location</label>
                                            <input asp-for="CustomLocation" class="form-control" placeholder="Enter your location" />
                                        </div>
                                        <span asp-validation-for="CustomLocation" class="text-danger"></span>
                                    </div>
                                    <div class="position-relative">
                                        <div class="rt-input-group">
                                            <label asp-for="Experience">Experience</label>
                                            <select asp-for="Experience" class="form-select" onchange="toggleCustomField(this, '#customExp')">
                                                <option value="1">1 Year</option>
                                                <option value="2">2 Years</option>
                                                <option value="1">3 Years</option>
                                                <option value="2">4 Years</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div id="customExp" class="rt-input-group" style="display: none; margin-top: 1rem;">
                                            <label asp-for="CusExperience">Custom Experience</label>
                                            <input asp-for="CusExperience" class="form-control" placeholder="Enter your required experience" />
                                        </div>
                                        <span asp-validation-for="CusExperience" class="text-danger"></span>
                                    </div>
                                </div>

                                <div class="row row-cols-sm-2 row-cols-1 g-3">
                                    <div class="position-relative">
                                        <div class="rt-input-group">
                                            <label asp-for="Salary">Salary</label>
                                            <input asp-for="Salary" placeholder="Enter salary" required>
                                        </div>
                                        <span asp-validation-for="Salary" class="text-danger"></span>
                                    </div>
                                    <div class="position-relative">
                                        <!-- Job Schedule Input -->
                                        <div class="rt-input-group">
                                            <label for="schedule">Working Type</label>
                                            <select asp-for="WorkingType" class="form-select" onchange="setWorkingHours(this)">
                                                <option value="" disabled selected>Select working type</option>
                                                <option value="Full-time">Full-time</option>
                                                <option value="Part-time">Part-time</option>
                                                <option value="Contract">Contract</option>
                                                <option value="Temporary">Temporary</option>
                                                <option value="Internship">Internship</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <span asp-validation-for="WorkingType" class="text-danger"></span>
                                        <div class="rt-input-group" id="customScheduleGroup" style="display: none; margin-top: 1rem;">
                                            <label asp-for="CusWorkingType">Custom Working Type</label>
                                            <input asp-for="CusWorkingType" placeholder="Enter custom Type">
                                        </div>
                                        <span asp-validation-for="CusWorkingType" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="rt-input-group">
                                    <label asp-for="WorkingHours">Working Hours</label>
                                    <input asp-for="WorkingHours" placeholder="Working Hours" required disabled>
                                </div>
                                <div class="position-relative">
                                    <div class="rt-input-group">
                                        <label asp-for="PayType">Pay Type</label>
                                        <select asp-for="PayType" class="form-select" onchange="toggleCustomField(this, '#customPayTypeGroup')">
                                            <option value="" disabled selected>Select pay type</option>
                                            <option value="Project">Project</option>
                                            <option value="Hourly">Hourly</option>
                                            <option value="Paid">Paid</option>
                                            <option value="Salary/Hourly">Salary/Hourly</option>
                                            <option value="Hourly/Project">Hourly/Project</option>
                                            <option value="None/Paid">None/Paid</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <span asp-validation-for="PayType" class="text-danger"></span>
                                    <div class="rt-input-group" id="customPayTypeGroup" style="display: none; margin-top: 1rem;">
                                        <label asp-for="CusPayType">Custom Pay Type</label>
                                        <input asp-for="CusPayType" placeholder="Enter Pay Type">
                                    </div>
                                    <span asp-validation-for="CusPayType" class="text-danger"></span>
                                </div>
                                <div class="rt-input-group">
                                    <label asp-for="Opening">Opening</label>
                                    <input asp-for="Opening" placeholder="Enter number of opening" min="@Model.Opening" required>
                                </div>
                                <span asp-validation-for="Opening" class="text-danger"></span>
                                <div class="rt-input-group">
                                    <label asp-for="Qualification">Qualification</label>
                                    <input asp-for="Qualification" placeholder="Qualification" required>
                                </div>
                                <span asp-validation-for="Qualification" class="text-danger"></span>
                                <div class="rt-input-group">
                                    <label asp-for="Benefits">Benefits</label>
                                    <textarea asp-for="Benefits" placeholder="Enter benefits" required></textarea>
                                </div>
                                <span asp-validation-for="Benefits" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <h6 class="fw-medium mt-30 mb-20" id="posttime">Post time</h6>
                <div class="social__links radius-16 p-30 bg-white">
                    <div class="info__field">
                        <div class="row row-cols-sm-1 row-cols-1 g-3">
                            <div class="info__field">
                                <div class="row row-cols-sm-2 row-cols-1 g-3">
                                    <!-- End Time -->
                                    <div class="position-relative">
                                        <div class="rt-input-group">
                                            <label asp-for="Close">End Time</label>
                                            <input type="date" asp-for="Close" class="form-control" min="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                                        </div>
                                        <span asp-validation-for="Close" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="rts__btn fill__btn" id="submit_btn">
                                Post Job
                            </button>
                        </div>
                    </div>
                </div>
            </form>
            
            <!-- submit form end -->
        </div>
    </div>
</div>
@section Scripts{
    <script>
        const skillList = @Html.Raw(JsonConvert.SerializeObject(ViewBag.SkillList));
        document.addEventListener("DOMContentLoaded", () => {
            initializeTagManager({
                inputSelector: "#skillInput",
                tagsContainerSelector: "#skillTags",
                recommendationsSelector: "#skillRecommendations",
                selectedItemsInputSelector: "#SelectedSkill",
                itemsList: skillList
            });
        });
        $.validator.setDefaults({ ignore: [] });

        function setWorkingHours(selectElement) {
            const hoursField = document.getElementById("WorkingHours");
            const type = selectElement.value;
            const hoursMap = {
                "Full-time": "35–40+ hrs/wk",
                "Part-time": "<35 hrs/wk",
                "Contract": "Varies",
                "Temporary": "Varies",
                "Internship": "Varies",
                "Other": ""
            };

            hoursField.value = hoursMap[type] ?? "";
            if(type == "Other"){
                hoursField.disabled = false;
            }else{
                hoursField.disabled = true;
            }
            toggleCustomField(selectElement, '#customScheduleGroup');
        }
    </script>
}