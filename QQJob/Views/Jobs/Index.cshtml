@model JobListViewModel
@{
    ViewBag.Title = "Job List";
    var skills = ViewBag.Skills as IEnumerable<Skill> ?? Enumerable.Empty<Skill>();
}
<div class="rts__section section__padding">
    <div class="container">
        <div class="row g-30">
            <div class="col-lg-5 col-xl-4">
                <div class="job__search__section mb-40">
                    <!-- AI Search Form -->
                    <form method="get" data-ajax="true" data-ajax-failure="onfail" data-ajax-loading="#loadingOverlay" data-ajax-complete="ajaxComplete()" data-ajax-method="get" data-ajax-update="#list" data-ajax-mode="replace" data-ajax-url="@Url.Action("GenericSearch","Jobs")" class="d-flex flex-column row-30" id="genericSearchForm">

                        <!-- AI Search Query -->
                        <div class="search__item mb-4 d-flex flex-column">
                            <label for="AiSearchQuery" class="mb-3 font-20 fw-medium text-dark text-capitalize">AI Powered Job Search</label>
                            <textarea name="AiSearchQuery" id="AiSearchQuery" class="form-control" placeholder="Describe the job you want..." rows="4" maxlength="200"></textarea>
                        </div>
                        <div class="search__item mb-4 d-flex flex-column">
                            <label class="mb-2 font-20 fw-medium text-dark text-capitalize" for="strictSearch">
                                Strict Match
                            </label>
                            <div class="form-check form-switch d-flex align-items-center gap-2  justify-content-center">
                                <input class="form-check-input align-content-center" value="true" type="checkbox" id="StrictSearch" name="StrictSearch" data-bs-toggle="tooltip" title="If enabled, only jobs matching all selected skills will be shown. If off, jobs with any of the skills will be shown.">
                            </div>
                        </div>
                        <!-- Search By Job Title -->
                        <div class="search__item">
                            <label class="mb-3 font-20 fw-medium text-dark text-capitalize">Search By Job Title</label>
                            <input type="text" id="search" name="jobTitle" placeholder="Enter Job Title" />
                        </div>

                        <!-- Search City -->
                        <div class="search__item">
                            <h6 class="mb-3 font-20 fw-medium text-dark text-capitalize">Search City</h6>
                            <input type="text" id="searchCity" name="city" placeholder="Enter City" />
                        </div>

                        <!-- Skills -->
                        <div class="search__item">
                            <h6 class="mb-3 font-20 fw-medium text-dark text-capitalize">Skill</h6>
                            <div class="search__item__list d-flex flex-wrap gap-3 list skills-scroll">
                                @foreach (var skill in skills)
                                {
                                    <div class="d-flex gap-2 align-items-center checkbox flex-shrink-0">
                                        <input type="checkbox" name="Skills" value="@skill.SkillName" id="@skill.SkillName">
                                        <label for="@skill.SkillName">@skill.SkillName</label>
                                    </div>
                                }
                            </div>
                        </div>

                        <!-- Experience Level -->
                        <div class="search__item">
                            <h6 class="mb-3 font-20 fw-medium text-dark text-capitalize">Experience Level</h6>
                            <div class="search__item__list">
                                <div class="search__item__list">
                                    <div class="d-flex align-items-center justify-content-between list">
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="ExperienceLevel" value="Intern" id="Intern">
                                            <label for="Intern">Intern</label>
                                        </div>
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="ExperienceLevel" value="Junior" id="Junior">
                                            <label for="Junior">Junior</label>
                                        </div>
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="ExperienceLevel" value="Middle" id="Middle">
                                            <label for="Middle">Middle</label>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between list">
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="ExperienceLevel" value="Senior" id="Senior">
                                            <label for="Senior">Senior</label>
                                        </div>
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="ExperienceLevel" value="Lead" id="Lead">
                                            <label for="Lead">Lead</label>
                                        </div>
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="ExperienceLevel" value="Manager" id="Manager">
                                            <label for="Manager">Manager</label>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between list">
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="ExperienceLevel" value="Director" id="Director">
                                            <label for="Director">Director</label>
                                        </div>
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="ExperienceLevel" value="Executive" id="Executive">
                                            <label for="Executive">Executive</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Salary Range -->
                        <div class="search__item">
                            <h6 class="mb-3 font-20 fw-medium text-dark text-capitalize">Salary Offered</h6>
                            <div class="search__item__list">
                                @{
                                    var salaries = new Dictionary<string, string>
                                                                {
                                                                { "-1000", "Under $1,000" },
                                                                { "1000-3000", "$1,000 - $3,000" },
                                                                { "3000-5000", "$3,000 - $5,000" },
                                                                { "5000-8000", "$5,000 - $8,000" },
                                                                { "8000-12000", "$8,000 - $12,000" },
                                                                { "12000-", "Above $12,000" }
                                                                };

                                    foreach (var salary in salaries)
                                    {
                                        <div class="d-flex gap-2 align-items-center checkbox">
                                            <input type="radio" name="salary" value="@salary.Key" id="@salary.Key">
                                            <label for="@salary.Key">@salary.Value</label>
                                        </div>
                                    }
                                }
                            </div>
                        </div>

                        <!-- Submit / Clear Buttons -->
                        <div class="d-flex align-items-center justify-content-between list">
                            <button type="submit" id="submitButton" class="rts__btn no__fill__btn max-content mx-auto job__search__btn font-sm">Find Job</button>
                            <button type="button" id="clearSearchBtn" class="rts__btn no__fill__btn max-content mx-auto job__search__btn font-sm">Clear</button>
                        </div>
                        @Html.HiddenFor(m => m.Paging.CurrentPage)
                    </form>

                </div>
            </div>

            <!-- Job List -->
            <div class="col-lg-7 col-xl-8" id="list">
                <partial name="_JobList" model="Model" />
            </div>
        </div>
    </div>
</div>
<div id="loadingOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(255,255,255,0.7); z-index:9999;">
    <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:20px;">
        <i class="fa fa-spinner fa-spin"></i> Searching...
    </div>
</div>

<!-- Scripts -->
@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.min.js"></script>
    <script>
        $(function () {
          $('[data-bs-toggle="tooltip"]').tooltip();
        });
        $('[data-bs-toggle="tooltip"]').on('shown.bs.tooltip', function () {
            const $icon = $(this);
            setTimeout(function () {
                $icon.tooltip('hide');
            }, 2000); // 2 seconds
        });
        function ajaxComplete() {
            // $('html, body').animate({
            //     scrollTop: $('#list').offset().top - 50
            // }, 500)
        }

        onfail = function onFail(xhr){
            showToastMessage(xhr.responseText, "warning");
        }

        function pagingSelect(selectedPage){
            $("#Paging_CurrentPage").val(selectedPage);
            $('#genericSearchForm').trigger('submit');
            $('html, body').animate({
                scrollTop: $('#list').offset().top - 50
            }, 500)
        }

        $('#clearSearchBtn').on('click', function (e) {
            $('html, body').animate({
                scrollTop: $('#list').offset().top - 50
            }, 500)
        });
        $(document).ready(function () {
            // Clear button
            $('#clearSearchBtn').on('click', function () {
                $('#genericSearchForm')[0].reset();
                $('#genericSearchForm').trigger('submit');
            });

            // Trigger search on skills or salary change
            $('input[name="Skills"], input[name="salary"], #StrictSearch').on('change', function () {
                $('#genericSearchForm').trigger('submit');
            });

            // Debounced search for title and city
            function debounce(func, delay) {
                let timeout;
                return function () {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(context, args), delay);
                };
            }

            $('#search, #searchCity').on('input', debounce(function () {
                $('#genericSearchForm').trigger('submit');
            }, 500));

            // Radio toggle logic
            let lastChecked = {};
            $('input[type="radio"]').on('click', function () {
                const name = $(this).attr('name');

                if (lastChecked[name] === this) {
                    this.checked = false;
                    lastChecked[name] = null;
                } else {
                    lastChecked[name] = this;
                }

                $('#genericSearchForm').trigger('submit');
            });
        });
    </script>
}
