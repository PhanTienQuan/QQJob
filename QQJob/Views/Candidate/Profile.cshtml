@model QQJob.ViewModels.CandidateViewModels.ProfileViewModel
@{
    ViewBag.Title = "Profile";
    var workingTypes = ViewBag.WorkingTypes as List<SelectListItem>;
    var avatarUrl = !string.IsNullOrEmpty(Model.Avatar) ? Model.Avatar : Url.Content("~/assets/img/avatars/default-avatar.jpg");
    var tempMessage = TempData["Message"] as string;
    string alertType = "info";
    string alertMsg = "";
    if (!string.IsNullOrEmpty(tempMessage))
    {
        try
        {
            var msgObj = Newtonsoft.Json.JsonConvert.DeserializeObject<dynamic>(tempMessage);
            alertType = msgObj?.type ?? "info";
            alertMsg = msgObj?.message ?? "";
        }
        catch
        {
            alertMsg = tempMessage;
        }
    }
}
<style>
    .author__image img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 50%;
        border: 2px solid #e5e5e5;
        background: #f8f8f8;
    }
    .social__links {
        border-radius: 16px;
        background: #fff;
        padding: 30px;
        margin-bottom: 20px;
    }
    .ql-container {
        min-height: 200px;
        border-radius: 8px;
    }
    .ql-toolbar {
        border-radius: 8px 8px 0 0;
    }
</style>
<form asp-action="Profile" asp-controller="Candidate" method="post" enctype="multipart/form-data">
    <input type="hidden" asp-for="Id" />
    <div class="dashboard__content d-flex template-dashboard ">
        <partial name="_LeftMenu" />
        <div class="dashboard__right">
            <div class="dash__content ">
                <div class="my__profile__tab radius-16 bg-white">
                    @if (!string.IsNullOrEmpty(alertMsg))
                    {
                        <div class="alert alert-@alertType mt-3" role="alert">
                            @alertMsg
                        </div>
                    }
                    <div class="my__details" id="info">
                        <div class="info__top">
                            <div class="author__image">
                                <img src="@avatarUrl" alt="Avatar">
                            </div>
                            <div class="select__image">
                                <label for="AvatarFile" class="file-upload__label">Upload New Photo</label>
                                <input type="file" asp-for="AvatarFile" class="file-upload__input" id="AvatarFile">
                                <span asp-validation-for="AvatarFile" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="info__field">
                            <div class="row row-cols-1 g-3">
                                <div class="rt-input-group">
                                    <label asp-for="FullName"></label>
                                    <input asp-for="FullName" class="form-control" required>
                                    <span asp-validation-for="FullName" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row row-cols-sm-2 row-cols-1 g-3">
                                <div class="rt-input-group">
                                    <label asp-for="Email"></label>
                                    <input asp-for="Email" class="form-control" required>
                                    <span asp-validation-for="Email" class="text-danger"></span>
                                </div>
                                <div class="rt-input-group">
                                    <label asp-for="PhoneNumber"></label>
                                    <input asp-for="PhoneNumber" class="form-control" required>
                                    <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="row row-cols-sm-2 row-cols-1 g-3">
                                <div class="rt-input-group">
                                    <label asp-for="JobTitle"></label>
                                    <input asp-for="JobTitle" class="form-control" required>
                                    <span asp-validation-for="JobTitle" class="text-danger"></span>
                                </div>
                                <div class="rt-input-group">
                                    <label asp-for="WorkingType">Working Type</label>
                                    <select asp-for="WorkingType" class="form-select" asp-items="workingTypes"></select>
                                    <span asp-validation-for="WorkingType" class="text-danger"></span>
                                </div>
                            </div>
                            <!-- editor area style giống PostJob -->
                            <h6 class="fw-medium mt-30 mb-20" id="jobdescription">Profile Description</h6>
                            <div class="social__links radius-16 p-30 bg-white">
                                <div class="info__field">
                                    <div class="row row-cols-sm-1 row-cols-1 g-3">
                                        <div class="info__field">
                                            <div class="row row-cols-1">
                                                <div id="DescriptionEditor" style="height: 200px;">@Html.Raw(Model.Description)</div>
                                                <span asp-validation-for="Description" class="text-danger"></span>
                                            </div>
                                            <input type="hidden" asp-for="Description" id="Description" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- editor area end -->
                            @if (!string.IsNullOrEmpty(Model.ResumeUrl))
                            {
                                <div class="rt-input-group">
                                    <label>Current Resume:</label>
                                    <a href="@Model.ResumeUrl" target="_blank">View Resume</a>
                                </div>
                            }
                            <div class="info__field">
                                <button type="submit" class="rts__btn fill__btn mx-0">Save Profile</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Social Links sẽ bổ sung sau -->
            </div>
        </div>
    </div>
</form>
@section Scripts {
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script>
        var quill = new Quill('#DescriptionEditor', {
            theme: 'snow',
            placeholder: 'Enter your description...',
            modules: {
                toolbar: [
                    [{ 'header': [6, false] }],
                    [{ 'size': [] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    [{ 'align': [] }],
                    ['blockquote'],
                    ['link'],
                    ['clean']
                ]
            }
        });
        // Sync Quill content to hidden input on submit
        document.querySelector('form').addEventListener('submit', function () {
            document.querySelector('#Description').value = quill.root.innerHTML;
        });
    </script>
}