@using QQJob.ViewModels.CandidateViewModels
@model FollowingEmployerListViewModel
@{
    ViewBag.Title = "Following Employer";
}
<style>
    .followed {
        background-color: var(--rts-button-1) !important;
        color: var(--rts-white) !important;
        cursor: pointer;
    }

    .followed:hover {
        background-color: unset !important;
        border: 1px solid var(--rts-border) !important;
    }

    .followed:hover i {
        color: black !important;
    }
</style>
    <!-- content area -->
<div class="dashboard__content d-flex template-dashboard ">
    <partial name="_LeftMenu" />
    <div class="dashboard__right">
        <div class="dash__content ">
            <!-- sidebar menu -->
            <div class="sidebar__menu d-md-block d-lg-none">
                <div class="sidebar__action"><i class="fa-sharp fa-regular fa-bars"></i> Sidebar</div>
            </div>
            <!-- sidebar menu end -->

            <div class="applied__job__info radius-16">

                <div class="job__filter">
                    <div class="search__job">
                        <div class="position-relative">
                            <input type="text" id="search" placeholder="Find Top Employer" required="">
                            <i class="fa-light fa-magnifying-glass"></i>
                        </div>
                    </div>
                </div>

                <div class="applied__job__list">
                    @if (Model.Follows.Any())
                    {
                        @foreach (var follow in Model.Follows)
                        {
                            var field = follow.Employer.CompanyField != null ? follow.Employer.CompanyField.Split(",").First() : "Field Not Specified";
                            var openJob = follow.Employer.Jobs.Where(j => j.Status == Status.Approved).Count();
                            <!-- single job -->
                            <div class="single__applied__job">
                                <div class="single__applied__job__content">
                                    <div class="icon">
                                        <img src="@follow.Employer.User.Avatar" alt="">
                                    </div>
                                    <div class="content">
                                        <a asp-action="EmployerDetail" asp-controller="Home" asp-route-id="@follow.EmployerId" asp-route-slug="@follow.Employer.User.Slug"> <h6>@follow.Employer.User.FullName</h6></a>
                                        <div class="content__info">
                                            <span><i class="fa-light fa-building"></i>@field</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="action">

                                    <a data-employer-id="@follow.EmployerId" class="action__btn follow-btn followed" style="color: inherit; text-decoration: none;">
                                        <i class="fa-light fa-heart"></i>
                                    </a>
                                    <button class="action__operation pending">
                                        @openJob Open Job
                                    </button>
                                </div>
                            </div>
                            <!--single job end  -->
                        }
                    }
                    else
                    {
                        <p>No Employer followed</p>
                    }

                </div>
            </div>
        </div>

        <div class="d-flex justify-content-center mt-30">
            <p class="copyright">Copyright © 2025 All Rights Reserved by QQJob</p>
        </div>
    </div>
</div>
<!-- content area end -->
@section Scripts {
    <script>
         $(document).on('click', '.follow-btn', function (e) {
            e.preventDefault();

            var $btn = $(this);
            var employerId = $btn.data('employer-id');

            $.ajax({
                type: 'POST',
                url: '/Candidate/Follow', // Change to your controller's route if different
                data: { employerId: employerId },
                success: function (response) {
                    // Show feedback (you can use toast, alert, etc.)
                    showToastMessage(response.message, "success");

                    var $icon = $btn.find('i');
                    if (response.success) {
                        $btn.addClass('followed');
                        $btn.attr('title', 'Unfollow');
                    } else {
                        $btn.removeClass('followed');
                        $btn.attr('title', 'Follow');
                    }
                },
                error: function (xhr) {
                    // Optionally handle errors (login warning, etc.)
                    alert('Something went wrong. Please try again.');
                }
            });
        });
    </script>
}